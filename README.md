# h1 Stay - ุณุฌู ุงูุชุบููุฑุงุช ูุงูููุงู

ููุตุฉ ุญุฌุฒ ุงูุดูู ูุงูุดุงูููุงุช ูู ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ

---

## โ ุงูููุงู ุงูููุชููุฉ

### 1. ุชุญุฏูุซ ูุนูููุงุช ุงูุชูุงุตู
**ุงูุญุงูุฉ:** โ ููุชูู

ุชู ุชุญุฏูุซ ุฌููุน ูุนูููุงุช ุงูุชูุงุตู ูู ุงููููุน:
- **ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:** Studio.ms.955@gmail.com
- **ุฑูู ุงูุฌูุงู 1:** 00966553437210
- **ุฑูู ุงูุฌูุงู 2:** 00966556943318

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `src/pages/Contact.tsx` - ุตูุญุฉ ุงุชุตู ุจูุง
- `src/pages/Refund.tsx` - ุณูุงุณุฉ ุงูุงุณุชุฑุฏุงุฏ
- `src/pages/Privacy.tsx` - ุณูุงุณุฉ ุงูุฎุตูุตูุฉ
- `src/pages/Terms.tsx` - ุงูุดุฑูุท ูุงูุฃุญูุงู

---

### 2. ุฅุตูุงุญ ุงูุชูุฑูุฑ ุนูุฏ ุงูุชููู ุจูู ุงูุตูุญุงุช
**ุงูุญุงูุฉ:** โ ููุชูู

**ุงููุดููุฉ:** ุนูุฏ ุงูุงูุชูุงู ูุตูุญุฉ ุฌุฏูุฏุฉุ ูุงูุช ุชูุชุญ ูู ุฃุณูู ุงูุตูุญุฉ ุจุฏูุงู ูู ุฃุนูุงูุง.

**ุงูุญู:** ุฅุถุงูุฉ ูููู `ScrollToTop` ููุชูุฑูุฑ ุชููุงุฆูุงู ูุฃุนูู ุงูุตูุญุฉ ุนูุฏ ุชุบููุฑ ุงููุณุงุฑ.

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `src/components/ScrollToTop.tsx` - ูููู ุฌุฏูุฏ ููุชูุฑูุฑ ุงูุชููุงุฆู
- `src/App.tsx` - ุฅุถุงูุฉ ุงููููู ููุชุทุจูู

---

### 3. Sprint 2.1 - ุชูุงูู ุงูุจูุงูุงุช ุงูุฏููุงููููุฉ
**ุงูุญุงูุฉ:** โ ููุชูู

ุชู ุงูุงูุชูุงู ูู ุงูุจูุงูุงุช ุงูุซุงุจุชุฉ ุฅูู ูุธุงู ุฏููุงูููู ูุนุชูุฏ ุนูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

#### ุงูุชุนุฏููุงุช:

**ุฃ) ุชุญุฏูุซ BookingDetailsDialog ููุญุงูุงุช ุงูุฌุฏูุฏุฉ:**
- ุฅุถุงูุฉ ุฃููุงู ููุตูุต ูุฌููุน ุญุงูุงุช ุงูุญุฌุฒ ุงูุซูุงููุฉ:
  - `draft` - ูุณูุฏุฉ
  - `pending_host` - ุจุงูุชุธุงุฑ ุฑุฏ ุงููุถูู
  - `awaiting_payment` - ุจุงูุชุธุงุฑ ุงูุฏูุน
  - `confirmed` - ูุคูุฏ
  - `payment_failed` - ูุดู ุงูุฏูุน
  - `expired` - ููุชูู ุงูุตูุงุญูุฉ
  - `cancelled` - ููุบู
  - `completed` - ููุชูู

**ุจ) ุชุญุฏูุซ ุตูุญุฉ AddProperty ููุจูุงูุงุช ุงูุฏููุงููููุฉ:**
- ุฌูุจ ุงููุฏู ูู ุฌุฏูู `cities` ุจุฏูุงู ูู ุงูููู ุงูุซุงุจุช
- ุฅุถุงูุฉ ุญูู ุงุฎุชูุงุฑ ููุน ุงููุญุฏุฉ ูู ุฌุฏูู `unit_types`
- ุฅุถุงูุฉ ูุงุฌูุฉ ุงุฎุชูุงุฑ ุงููุฑุงูู ูู ุฌุฏูู `amenities_master`
- ุฏุนู ุงูุชุตูููุงุช ูููุฑุงูู ูุน ุนุฑุถูุง ุจุดูู ููุธู
- ุญูู ุฅุถุงูู ูุฅุฏุฎุงู ูุฑุงูู ูุฎุตุตุฉ ุบูุฑ ููุฌูุฏุฉ ูู ุงููุงุฆูุฉ
- ุญูุธ `city_id` ู `unit_type_id` ูู ุฌุฏูู ุงูุนูุงุฑุงุช

**ุงููููุงุช ุงููุนุฏูุฉ:**
- `src/components/guest/BookingDetailsDialog.tsx`
- `src/pages/AddProperty.tsx`

---

### 4. Sprint 2.2 - ุชูุงูู SMS ูุฑูุงุจุท ุงูุฏูุน
**ุงูุญุงูุฉ:** โ ููุชูู

#### ุฃ) Edge Function: send-sms
**ุงูููู:** `supabase/functions/send-sms/index.ts`

**ุงููููุฒุงุช:**
- ุฏุนู ูุฒูุฏู SMS: Unifonic (ุฃุณุงุณู) ู Twilio (ุงุญุชูุงุทู)
- ููุงูุจ ุฑุณุงุฆู ุฌุงูุฒุฉ ุซูุงุฆูุฉ ุงููุบุฉ (ุนุฑุจู/ุฅูุฌููุฒู):
  - `booking_created` - ุฅูุดุงุก ุญุฌุฒ ุฌุฏูุฏ
  - `booking_accepted` - ูุจูู ุงูุญุฌุฒ ูู ุงููุถูู
  - `payment_reminder` - ุชุฐููุฑ ุจุงูุฏูุน
  - `payment_received` - ุชุฃููุฏ ุงุณุชูุงู ุงูุฏูุน
  - `booking_confirmed` - ุชุฃููุฏ ุงูุญุฌุฒ ุงูููุงุฆู
  - `booking_cancelled` - ุฅูุบุงุก ุงูุญุฌุฒ
  - `payment_link` - ุฑุงุจุท ุงูุฏูุน
- ุชูุณูู ุฃุฑูุงู ุงูููุงุชู ุชููุงุฆูุงู ูุตูุบุฉ E.164
- ุชุณุฌูู ุฌููุน ุงูุฑุณุงุฆู ูู ุฌุฏูู `sms_logs`
- ุฏุนู ุงููุชุบูุฑุงุช ุงูุฏููุงููููุฉ ูู ุงูููุงูุจ

**ุงูุงุณุชุฎุฏุงู:**
```typescript
await supabase.functions.invoke('send-sms', {
  body: {
    phone: '+966XXXXXXXXX',
    template: 'booking_confirmed',
    variables: {
      property_name: 'ุงุณู ุงูุนูุงุฑ',
      check_in: '2024-01-15',
      check_out: '2024-01-20',
      booking_code: 'ABC123'
    },
    booking_id: 'uuid',
    user_id: 'uuid',
    language: 'ar'
  }
});
```

---

#### ุจ) Edge Function: generate-payment-link
**ุงูููู:** `supabase/functions/generate-payment-link/index.ts`

**ุงููููุฒุงุช:**
- ุชูููุฏ ุฑุงุจุท ุฏูุน ุขูู ุจุงุณุชุฎุฏุงู UUID
- ุงูุชุญูู ูู ุตูุงุญูุฉ ุชุฑุฎูุต ุงูุนูุงุฑ ูุจู ุงูุชูููุฏ
- ุชุนููู ูููุฉ ุงูุฏูุน (`payment_deadline`)
- ุฅุฑุณุงู SMS ุชููุงุฆู ููุถูู ุนูุฏ ุงูุทูุจ
- ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูุฑุงุจุท ุงูุญุงูู ุฅุฐุง ูุงู ุตุงูุญุงู
- ุฅูุบุงุก ุงูุญุฌุฒ ุชููุงุฆูุงู ุฅุฐุง ุงูุชูู ุชุฑุฎูุต ุงูุนูุงุฑ

**ุงูุงุณุชุฎุฏุงู:**
```typescript
await supabase.functions.invoke('generate-payment-link', {
  body: {
    booking_id: 'uuid',
    expires_in_hours: 24, // ุงุฎุชูุงุฑูุ ุงูุงูุชุฑุงุถู 24 ุณุงุนุฉ
    send_sms: true // ุงุฎุชูุงุฑูุ ูุฅุฑุณุงู SMS ููุถูู
  }
});
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
  "success": true,
  "payment_link": "https://h1stay.com/pay/uuid-token",
  "token": "uuid-token",
  "expires_at": "2024-01-16T12:00:00Z",
  "amount": 1500.00
}
```

---

#### ุฌ) Edge Function: check-booking-timers
**ุงูููู:** `supabase/functions/check-booking-timers/index.ts`

**ุงููููุฒุงุช:**
- ูุญุต ุฏูุฑู ูุงูุชูุงุก ุตูุงุญูุฉ ุงูุญุฌูุฒุงุช
- ุฅูุบุงุก ุงูุญุฌูุฒุงุช ูู ุญุงูุฉ `pending_host` ุจุนุฏ ุงูุชูุงุก `response_deadline`
- ุฅูุบุงุก ุงูุญุฌูุฒุงุช ูู ุญุงูุฉ `awaiting_payment` ุจุนุฏ ุงูุชูุงุก `payment_deadline`
- ุฅูุบุงุก ุญุฌูุฒุงุช ุงูุนูุงุฑุงุช ุงูุชู ุงูุชูู ุชุฑุฎูุตูุง
- ุฅุฑุณุงู ุฅุดุนุงุฑุงุช ูููุถูู ูุงูุถูู ุนูุฏ ุงูุชูุงุก ุงูุตูุงุญูุฉ

---

#### ุฏ) ูููู PaymentCountdown
**ุงูููู:** `src/components/booking/PaymentCountdown.tsx`

**ุงููููุฒุงุช:**
- ุนุฏุงุฏ ุชูุงุฒูู ูู ุงูููุช ุงููุนูู
- ุซูุงุซุฉ ุฃุดูุงู ููุนุฑุถ: `default`, `compact`, `badge`
- ุชุบููุฑ ุงูุฃููุงู ุญุณุจ ุงูุงุณุชุนุฌุงู:
  - ุฃุฎุถุฑ: ุฃูุซุฑ ูู ุณุงุนุฉ
  - ุฃุตูุฑ: ุฃูู ูู ุณุงุนุฉ
  - ุฃุญูุฑ: ุฃูู ูู 15 ุฏูููุฉ
- callback ุนูุฏ ุงูุชูุงุก ุงูููุช
- ุฏุนู ุซูุงุฆู ุงููุบุฉ

**ุงูุงุณุชุฎุฏุงู:**
```tsx
<PaymentCountdown 
  deadline={booking.payment_deadline}
  variant="default"
  onExpired={() => refetchBooking()}
/>
```

---

#### ูู) ูููู PriceBreakdown
**ุงูููู:** `src/components/booking/PriceBreakdown.tsx`

**ุงููููุฒุงุช:**
- ุนุฑุถ ุชูุตููู ูููููุงุช ุงูุณุนุฑ:
  - ุณุนุฑ ุงููููุฉ ร ุนุฏุฏ ุงูููุงูู
  - ุถุฑูุจุฉ ุงููููุฉ ุงููุถุงูุฉ (VAT)
  - ุงูุถุฑุงุฆุจ ุงูุฃุฎุฑู
  - ุฑุณูู ุงูุฎุฏูุฉ
  - ุถุฑูุจุฉ ุฑุณูู ุงูุฎุฏูุฉ
- ูุถุน ุชูุงุตูู ุงููุถูู (`showHostDetails`):
  - ุนูููุฉ ุงูููุตุฉ
  - ุถุฑูุจุฉ ุงูุนูููุฉ
  - ุตุงูู ุงููุถูู
  - ุฅูุฑุงุฏ ุงูููุตุฉ
- tooltips ุชูุถูุญูุฉ ูููุณุจ
- ุฏุนู ุซูุงุฆู ุงููุบุฉ

**ุงูุงุณุชุฎุฏุงู:**
```tsx
<PriceBreakdown
  accommodationBasePrice={1000}
  nights={3}
  pricePerNight={333.33}
  hostVatAmount={150}
  hostVatRate={15}
  guestCommissionAmount={50}
  guestCommissionRate={5}
  guestCommissionVat={7.5}
  taxes={[]}
  totalTaxes={150}
  totalForGuest={1207.5}
  currencyCode="SAR"
  showHostDetails={false}
/>
```

---

#### ู) ูููู BookingStateBadge
**ุงูููู:** `src/components/booking/BookingStateBadge.tsx`

**ุงููููุฒุงุช:**
- ุดุงุฑุฉ ููููุฉ ูุนุฑุถ ุญุงูุฉ ุงูุญุฌุฒ
- 8 ุญุงูุงุช ูุฎุชููุฉ ูุน ุฃููุงู ูุฃููููุงุช ูููุฒุฉ
- ุฏุนู ุซูุงุฆู ุงููุบุฉ

---

## ๐ ุงูููุงู ุงูููุชุฑุญุฉ

### ููุฏ ุงูุงูุชุธุงุฑ
- [ ] ุฅูุดุงุก ุตูุญุฉ `/pay/:token` ููุนุงูุฌุฉ ุงูุฏูุน
- [ ] ุฅุถุงูุฉ Edge Function ููู Payment Webhook
- [ ] ุฅูุดุงุก Edge Function ูุชูููุฏ ุงูููุงุชูุฑ
- [ ] ุฅุถุงูุฉ ุฑูุงุจุท ูุงุชุณุงุจ ููุชูุงุตู ุงููุจุงุดุฑ
- [ ] ุฅุถุงูุฉ ุฎุฑูุทุฉ ุงููููุน (Sitemap)
- [ ] ุฑุจุท API ูุฒุงุฑุฉ ุงูุณูุงุญุฉ ููุชุญูู ูู ุชุฑุงุฎูุต ุงูุฅูุงูุฉ
- [ ] ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนูุฏ ุงูุญุฌูุฒุงุช ุงูุฌุฏูุฏุฉ
- [ ] ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ุนูู ุงูุฌูุงู
- [ ] ุฅุถุงูุฉ ูุธุงู ุฏูุน ุฅููุชุฑููู ูุชูุงูู

---

## ๐ ุงููุชุทูุจุงุช ููุชุดุบูู

### ููุงุชูุญ API ุงููุทููุจุฉ (Secrets)
ูุชูุนูู ุฎุฏูุฉ SMSุ ูุฌุจ ุฅุถุงูุฉ ุฃุญุฏ ุงููุฒูุฏูู:

**Unifonic (ูููุถูู ููุณุนูุฏูุฉ):**
- `UNIFONIC_API_KEY` - ููุชุงุญ API ูู Unifonic

**Twilio (ุจุฏูู):**
- `TWILIO_ACCOUNT_SID` - ูุนุฑู ุญุณุงุจ Twilio
- `TWILIO_AUTH_TOKEN` - ุฑูุฒ ุงููุตุงุฏูุฉ
- `TWILIO_PHONE_NUMBER` - ุฑูู ุงููุงุชู ุงููุฑุณู

**ุฅุนุฏุงุฏุงุช ุนุงูุฉ:**
- `SITE_URL` - ุฑุงุจุท ุงููููุน (ุงูุงูุชุฑุงุถู: https://h1stay.com)

---

## ๐๏ธ ุงูุชูููุงุช ุงููุณุชุฎุฏูุฉ

- **Frontend:** React, TypeScript, Vite
- **Styling:** Tailwind CSS, shadcn/ui
- **Backend:**  (Supabase)
- **Edge Functions:** Deno (TypeScript)
- **Internationalization:** i18next (ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ)
- **State Management:** TanStack Query
- **SMS Providers:** Unifonic, Twilio

---

## ๐ ูููู ุงููุดุฑูุน

```
src/
โโโ components/
โ   โโโ booking/          # ููููุงุช ุงูุญุฌุฒ
โ   โ   โโโ BookingStateBadge.tsx
โ   โ   โโโ PaymentCountdown.tsx
โ   โ   โโโ PriceBreakdown.tsx
โ   โโโ guest/            # ููููุงุช ุงูุถูู
โ   โโโ host/             # ููููุงุช ุงููุถูู
โ   โโโ admin/            # ููููุงุช ุงูุฅุฏุงุฑุฉ
โ   โโโ ui/               # ููููุงุช shadcn/ui
โโโ pages/                # ุตูุญุงุช ุงูุชุทุจูู
โโโ contexts/             # ุณูุงูุงุช React (Auth, etc.)
โโโ hooks/                # Custom Hooks
โโโ i18n/                 # ูููุงุช ุงูุชุฑุฌูุฉ
โโโ integrations/         # ุชูุงููุงุช Supabase
โโโ utils/                # ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ

supabase/
โโโ functions/
    โโโ send-sms/               # ุฅุฑุณุงู ุงูุฑุณุงุฆู ุงููุตูุฉ
    โโโ generate-payment-link/  # ุชูููุฏ ุฑูุงุจุท ุงูุฏูุน
    โโโ check-booking-timers/   # ูุญุต ุงูุชูุงุก ุตูุงุญูุฉ ุงูุญุฌูุฒุงุช
    โโโ calculate-booking-price/ # ุญุณุงุจ ุณุนุฑ ุงูุญุฌุฒ
    โโโ print-booking/          # ุทุจุงุนุฉ ุชูุงุตูู ุงูุญุฌุฒ
```

---

## ๐ ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ

| ุงูุฌุฏูู | ุงููุตู |
|--------|-------|
| `profiles` | ุจูุงูุงุช ุงููุณุชุฎุฏููู |
| `properties` | ุงูุนูุงุฑุงุช |
| `bookings` | ุงูุญุฌูุฒุงุช |
| `cities` | ุงููุฏู |
| `districts` | ุงูุฃุญูุงุก |
| `countries` | ุงูุฏูู |
| `unit_types` | ุฃููุงุน ุงููุญุฏุงุช |
| `amenities_master` | ุงููุฑุงูู |
| `tax_rules` | ููุงุนุฏ ุงูุถุฑุงุฆุจ |
| `commission_rules` | ููุงุนุฏ ุงูุนูููุงุช |
| `sms_logs` | ุณุฌู ุงูุฑุณุงุฆู ุงููุตูุฉ |
| `notifications` | ุงูุฅุดุนุงุฑุงุช |

---

## ๐ ููุงุญุธุงุช

- ุงููููุน ูุฏุนู ุงููุบุชูู ุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- ุฌููุน ุงูุตูุญุงุช ูุชุฌุงูุจุฉ ูุน ุงูุฌูุงู
- ูุชู ุงูุชูุฑูุฑ ุชููุงุฆูุงู ูุฃุนูู ุงูุตูุญุฉ ุนูุฏ ุงูุชููู
- ูุธุงู ุงูุญุฌุฒ ูุฏุนู 8 ุญุงูุงุช ูุฎุชููุฉ ูุน ุชุชุจุน ูุงูู
- Edge Functions ุชููุดุฑ ุชููุงุฆูุงู ุนูุฏ ุงูุญูุธ
